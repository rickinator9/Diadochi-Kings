namespace = slavery

#
# NOTIFICATIONS
#

# Character is notified he is becoming a slave
character_event = {
	id = slavery.1
	desc = "slavery.1.desc"
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes # Triggered by decision: enslave
	
	option = {
		name = "slavery.11.name"
		
		if = {
			limit = {
				is_ruler = yes
			}
			current_heir = {
				character_event = {
					id = slavery.2
				}
				abdicate = yes # Slaves can't rule
			}
		}
		add_trait = slave
		move_character = FROM
	}
}

# Heir is notified
character_event = {
	id = slavery.2
	desc = "slavery.2.desc"	
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes # Triggered by slavery.1
	
	option = {
		name = "slavery.21.name"
		
		custom_tooltip = {
			FROM = {
				add_trait = slave
			}
		}
	}
}


# Slave is notified he is now free
character_event = {
	id = slavery.3
	desc = "AI"
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes # Triggered by decision: free_slave
	
	option = {
		name = "AI"
		
		remove_trait = slave
		any_dynasty_member = {
			character_event = {
				id = slavery.4
			}
		}
		random_dynasty_member = {
			limit = {
				is_ruler = yes
			}
			ROOT = {
				move_character = PREV
			}
		}
	}
}

# Dynasty members are notified
character_event = {
	id = slavery.4
	desc = "slavery.4.desc"
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes # Triggered by slavery.3
	
	option = {
		name = "slavery.41.name"
	}
}

#
# Buying / Selling system
# 

character_event = {
	id = slavery.5
	desc = "slavery.5.desc"
	picture = GFX_evt_child_reading # Placeholder
	
	trigger = {
		has_character_flag = buying_slaves
		NOT = {
			has_character_flag = making_offer
		}
		any_independent_ruler = {
			any_realm_character = {
				has_character_flag = slave_to_be_sold
			}
		}
	}
	
	mean_time_to_happen = {
		months = 5
	}
	
	option = {
		name = "slavery.51.name" # Make an offer
		ai_chance = {
			factor = 1
		}
		
		any_independent_ruler = {
			random_realm_character = {
				limit = {
					has_character_flag = slave_to_be_sold
					NOT = {
						has_character_flag = offer_made
					}
				}
				character_event = {
					id = slavery.6
				}
			}
			set_character_flag = making_offer
		}
	}
	
	option = {
		name = "slavery.52.name" # That slave in bad
		ai_chance = {
			factor = 1
		}
	}
}

character_event = {
	id = slavery.6
	desc = "AI"
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes
	
	option = {
		name = "AI"
		
		set_character_flag = offer_made
		
		host = {
			character_event = {
				id = slavery.6
			}
		}
	}
}

character_event = {
	id = slavery.7
	desc = "slavery.7.desc"
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes
	
	option = {
		name = "slavery.71.name"
		
		FROMFROM = { # The buyer
			character_event = {
				id = slavery.8
			}
		}
	}
}

character_event = {
	id = slavery.8
	desc = "slavery.8.desc"
	picture = GFX_evt_child_reading # Placeholder
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = making_offer
		clr_character_flag = offer_made
	}
	
	option = {
		name = "slavery.81.name" # Pay
		ai_chance = {
			factor = 1
		}
		
		transfer_scaled_wealth = {
			to = FROM
			value = 0.5
		}
		FROMFROM = {			
			move_character = ROOT
		}
	}
	option = {
		name = "slavery.82.name" # Cancel offer
		ai_chance = {
			factor = 1
		}
	}
}